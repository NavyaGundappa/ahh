{% extends "base.html" %}

{% block title %}Blog - Aarogya Hastha{% endblock %}

{% block content %}
<div class="blog-container">
    <!-- Clean Mobile Hero Section -->
    <section class="blog-hero">
        <div class="hero-background">
            <img src="{{ url_for('static', filename='img/blog-hero.png') }}" alt="Aarogya Hastha Health Blog" class="hero-bg-image">
            <!-- Clean overlay - removed for mobile -->
            <div class="hero-overlay"></div>
        </div>
        <div class="hero-content">
            <div class="hero-text-container">
                <h1 class="hero-title">Health & Wellness Blog</h1>
                <p class="hero-subtitle">Expert medical insights, health tips, and wellness guidance from Aarogya Hastha specialists</p>
            </div>
        </div>
    </section>

    <section class="search-filter-section">
        <div class="search-filter-container">
            <div class="search-box">
                <i class="search-icon" aria-hidden="true">üîç</i>
                <input type="text" id="blogSearch" placeholder="Search health articles, treatments, or conditions...">
            </div>
            <div class="filter-controls">
                <select id="departmentFilter" class="department-dropdown">
                    <option value="all">All Departments</option>
                    {% for department in departments %}
                    <option value="{{ department.slug }}">{{ department.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </section>

    <section class="blogs-section">
        <div id="blogsLoading" class="loading-spinner">
            <div class="spinner"></div>
            <p>Loading health articles...</p>
        </div>
        <div id="blogsGrid" class="blogs-grid" style="display: none;">
            </div>
        <div id="noBlogs" class="no-results" style="display: none;">
            <div class="no-results-content">
                <i class="no-results-icon" aria-hidden="true">üìù</i>
                <h3>No articles found</h3>
                <p>Try adjusting your search terms or select a different department</p>
            </div>
        </div>
    </section>
</div>

<style>
/* Modern CSS: Standardized with CSS Variables and REM units */
:root {
    /* Colors */
    --color-primary: #3498db;
    --color-primary-dark: #2980b9;
    --color-secondary: #2c3e50;
    --color-text: #7f8c8d;
    --color-background-light: #f8f9fa;
    --color-white: #ffffff;
    --color-border: #e0e0e0;

    /* Spacing */
    --space-xs: 0.5rem;   /* 8px */
    --space-sm: 1rem;     /* 16px */
    --space-md: 1.5rem;   /* 24px */
    --space-lg: 2rem;     /* 32px */
    --space-xl: 3rem;     /* 48px */
    
    /* Layout */
    --max-width-container: 87.5rem; /* 1400px */
    --max-width-search: 50rem; /* 800px */
}

/* Global Container */
.blog-container {
    max-width: var(--max-width-container);
    margin: 0 auto;
    padding: 0;
}

/* --- Desktop Hero Section (Text at Bottom) --- */
.blog-hero {
    position: relative;
    min-height: 60vh;
    overflow: hidden;
    display: flex;
    align-items: flex-end; /* Default: text at bottom for desktop */
    justify-content: center;
    text-align: center;
}

.hero-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
}

.hero-bg-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
}

/* Clean overlay for desktop only */
.hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.2); /* Simple overlay for desktop */
    z-index: 2;
}

.hero-content {
    position: relative;
    z-index: 3;
    color: var(--color-white);
    width: 100%;
    padding: var(--space-xl) var(--space-md) var(--space-lg) var(--space-md);
    display: flex;
    align-items: center;
    justify-content: center;
}

.hero-text-container {
    max-width: 40rem;
    width: 100%;
}

.hero-title {
    font-size: 2.5rem;
    font-weight: 800;
    line-height: 1.2;
    margin: 0 0 var(--space-sm) 0;
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    color: var(--color-white);
}

.hero-subtitle {
    font-size: 1.1rem;
    margin: 0;
    opacity: 0.95;
    line-height: 1.6;
    font-weight: 400;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    color: var(--color-white);
}

/* --- Search & Filter Section --- */
.search-filter-section {
    padding: var(--space-xl) var(--space-md);
    background: var(--color-background-light);
}

.search-filter-container {
    display: flex;
    gap: var(--space-md);
    align-items: center;
    max-width: var(--max-width-search);
    margin: 0 auto;
}

.search-box {
    flex: 2;
    position: relative;
    display: flex;
    align-items: center;
}

.search-icon {
    position: absolute;
    left: 1.25rem;
    font-size: 1.2rem;
    color: var(--color-text);
    z-index: 2;
}

.search-box input {
    width: 100%;
    padding: 1rem 1.25rem 1rem 3.125rem;
    border: 2px solid var(--color-border);
    border-radius: 0.75rem;
    font-size: 1rem;
    background: var(--color-white);
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
}

.search-box input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 4px 20px rgba(52, 152, 219, 0.15);
}

.filter-controls {
    flex: 1;
}

.department-dropdown {
    width: 100%;
    padding: 1rem 1.25rem;
    border: 2px solid var(--color-border);
    border-radius: 0.75rem;
    font-size: 1rem;
    background: var(--color-white);
    cursor: pointer;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    appearance: none;
    transition: all 0.3s ease;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%237f8c8d' d='M6 8.825L1.175 4 2.238 2.938 6 6.7l3.763-3.762L10.825 4z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 0.75rem;
}

.department-dropdown:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 4px 20px rgba(52, 152, 219, 0.15);
}

/* --- Blogs Grid --- */
.blogs-section {
    padding: 0;
}

.blogs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(18.75rem, 1fr));
    gap: var(--space-lg);
    padding: var(--space-xl) var(--space-md);
    max-width: 75rem;
    margin: 0 auto;
}

.blog-card {
    background: var(--color-white);
   
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    cursor: pointer;
    border: 1px solid #f0f0f0;
    display: flex;
    flex-direction: column;
    height: 25rem;
    transition: all 0.3s ease;
}



.blog-image {
    width: 18rem;
    height: 12rem;
    margin: 1.25rem auto 1rem auto;
    overflow: hidden;
    background: var(--color-background-light);
    
}

.blog-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  
}


.blog-content {
    padding: 0 var(--space-md) var(--space-md) var(--space-md);
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.blog-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--color-secondary);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin: 0;
    text-align: center;
}

.blog-date {
    font-size: 0.9rem;
    color: var(--color-text);
    font-weight: 500;
    margin: 0;
    text-align: center;
}

.read-more-container {
    margin-top: auto;
}

.read-more-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ffffff; /* White text */
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    padding: 0.50rem 0;
    width: 50%;
    border: 2px solid #16979D; /* matching gradient start */
    
    background: linear-gradient(to bottom, #16979D, #103A60); /* Gradient background */
    transition: all 0.3s ease;
    
    margin: 0 auto; /* Center horizontally */
}


.read-more-btn:hover {
background: linear-gradient(to bottom, #7FD1D5, #4D7FA3); /* Even lighter gradient */
    color: #ffffff;
  
}


/* --- Utility Sections: Loading & No Results --- */
.loading-spinner {
    text-align: center;
    padding: var(--space-xl) var(--space-md);
}

.spinner {
    width: 3rem;
    height: 3rem;
    border: 3px solid #f3f3f3;
    border-top: 3px solid var(--color-primary);
    border-radius: 50%;
    animation: spin 1.5s linear infinite;
    margin: 0 auto var(--space-sm);
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.no-results {
    text-align: center;
    padding: var(--space-xl) var(--space-md);
}

.no-results-content {
    max-width: 21.875rem;
    margin: 0 auto;
}

.no-results-icon {
    font-size: 3rem;
    margin-bottom: var(--space-sm);
    opacity: 0.5;
    color: var(--color-primary);
}

.no-results h3 {
    color: var(--color-secondary);
    margin-bottom: var(--space-xs);
    font-size: 1.4rem;
}

.no-results p {
    color: var(--color-text);
    line-height: 1.5;
    font-size: 1rem;
}

/* --- Mobile-First Media Queries --- */

/* Large screens */
@media (min-width: 75rem) { /* 1200px */
    .hero-title {
        font-size: 3.5rem;
    }
    
    .hero-subtitle {
        font-size: 1.3rem;
    }
}

/* Tablet and smaller laptops */
@media (max-width: 64rem) { /* 1024px */
    .blog-hero {
        min-height: 55vh;
    }
    
    .hero-title {
        font-size: 2.2rem;
    }
    
    .hero-subtitle {
        font-size: 1.1rem;
    }
    
    .blogs-grid {
        grid-template-columns: repeat(auto-fit, minmax(17.5rem, 1fr));
        gap: var(--space-md);
        padding: 2.5rem 1.5rem;
    }
}

/* Mobile landscape and tablets - REMOVE GREY CONTAINER */
@media (max-width: 48rem) { /* 768px */
    .blog-hero {
        min-height: 50vh;
        align-items: center; /* Move text to center for mobile */
    }
    
    /* COMPLETELY REMOVE OVERLAY FOR MOBILE - NO GREY CONTAINER */
    .hero-overlay {
        display: none;
    }
    
    .hero-content {
        padding: var(--space-xl) var(--space-md); /* Equal padding top and bottom */
    }
    
    /* Enhanced text shadows for better readability without overlay */
    .hero-title {
        font-size: 1.8rem;
        margin-bottom: var(--space-xs);
        text-shadow: 0 2px 8px rgba(0,0,0,0.7);
    }
    
    .hero-subtitle {
        font-size: 0.9rem;
        line-height: 1.4;
        text-shadow: 0 1px 4px rgba(0,0,0,0.7);
    }
    
    .search-filter-section {
        padding: var(--space-lg) var(--space-md);
    }
    
    .search-filter-container {
        flex-direction: column;
        gap: var(--space-sm);
    }
    
    .search-box, .filter-controls {
        width: 100%;
    }
    
    .blogs-grid {
        grid-template-columns: repeat(auto-fit, minmax(16.25rem, 1fr));
        gap: var(--space-md);
        padding: var(--space-lg) var(--space-md);
    }
    
    .blog-card {
        height: 23rem;
    }
    
    .blog-image {
        width: 10rem;
        height: 10rem;
    }
}

/* Mobile devices - NO GREY CONTAINER */
@media (max-width: 40rem) { /* 640px */
    .blog-hero {
        min-height: 45vh;
        align-items: center; /* Keep text centered */
    }
    
    /* Ensure overlay is still removed */
    .hero-overlay {
        display: none;
    }
    
    .hero-content {
        padding: var(--space-lg) var(--space-sm); /* Keep text up */
    }
    
    /* Further reduced text size for smaller mobile */
    .hero-title {
        font-size: 1.6rem;
        text-shadow: 0 2px 6px rgba(0,0,0,0.7);
    }
    
    .hero-subtitle {
        font-size: 0.85rem;
        text-shadow: 0 1px 3px rgba(0,0,0,0.7);
    }
    
    .blogs-grid {
        grid-template-columns: 1fr;
        gap: var(--space-md);
        padding: var(--space-md) var(--space-sm);
    }
    
    .blog-card {
        height: auto;
        min-height: 22rem;
    }
    
    .blog-content {
        padding: 0 1.25rem 1.25rem 1.25rem;
    }
}

/* Small mobile devices - NO GREY CONTAINER */
@media (max-width: 30rem) { /* 480px */
    .blog-hero {
        min-height: 40vh;
        align-items: center; /* Keep text centered */
    }
    
    /* Ensure overlay is still removed */
    .hero-overlay {
        display: none;
    }
    
    .hero-content {
        padding: var(--space-lg) var(--space-sm); /* Keep text up */
    }
    
    /* Smallest text size for very small devices */
    .hero-title {
        font-size: 1.4rem;
        text-shadow: 0 2px 5px rgba(0,0,0,0.7);
    }
    
    .hero-subtitle {
        font-size: 0.8rem;
        line-height: 1.3;
        text-shadow: 0 1px 3px rgba(0,0,0,0.7);
    }
    
    .search-filter-section {
        padding: var(--space-md) var(--space-sm);
    }
    
    .search-box input, .department-dropdown {
        padding: 0.875rem 0.9375rem 0.875rem 2.8125rem;
        font-size: 0.95rem;
    }
    
    .search-icon {
        left: 0.9375rem;
    }
    
    .blogs-grid {
        padding: var(--space-md) 0.75rem;
    }
    
    .blog-card {
        min-height: 20rem;
    }
    
    .blog-image {
        width: 9rem;
        height: 9rem;
        margin: 1rem auto 0.75rem auto;
    }
    
    .blog-content {
        padding: 0 var(--space-sm) var(--space-sm) var(--space-sm);
        gap: 0.75rem;
    }
    
    .blog-title {
        font-size: 1.1rem;
    }
    
    .blog-date {
        font-size: 0.8rem;
    }
    
    .read-more-btn {
        font-size: 0.85rem;
        padding: 0.625rem 0;
    }
}

/* Extra small devices - NO GREY CONTAINER */
@media (max-width: 23.4375rem) { /* 375px */
    .blog-hero {
        min-height: 35vh;
        align-items: center; /* Keep text centered */
    }
    
    /* Ensure overlay is still removed */
    .hero-overlay {
        display: none;
    }
    
    .hero-title {
        font-size: 1.3rem;
        text-shadow: 0 2px 4px rgba(0,0,0,0.7);
    }
    
    .hero-subtitle {
        font-size: 0.75rem;
        text-shadow: 0 1px 2px rgba(0,0,0,0.7);
    }
    
    .blog-card {
        min-height: 19rem;
    }
    
    .blog-image {
        width: 8rem;
        height: 8rem;
    }
}

/* --- Accessibility & Touch Improvements --- */

/* Touch-friendly improvements for mobile */
@media (hover: none) and (pointer: coarse) {
    .blog-card:hover {
        transform: none;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .blog-card:active {
        transform: scale(0.98);
    }
    
    .read-more-btn {
        padding: 0.875rem 0;
    }
    
    .read-more-btn:active {
        background: var(--color-primary);
        color: var(--color-white);
    }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .blog-card {
        border: 2px solid var(--color-secondary);
    }
    
    .search-box input, .department-dropdown {
        border: 2px solid var(--color-secondary);
    }
    
    .hero-title, .hero-subtitle {
        text-shadow: 0 2px 4px rgba(0,0,0,0.9);
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .blog-card, .blog-image img, .read-more-btn {
        transition: none;
    }
    
    .spinner {
        animation: none;
        border-top-color: transparent;
    }
    
    .blog-card:hover {
        transform: none;
    }
    
    .blog-card:hover .blog-image img {
        transform: none;
    }
    
    .read-more-btn:hover {
        transform: none;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const blogSearch = document.getElementById('blogSearch');
    const departmentFilter = document.getElementById('departmentFilter');
    const blogsGrid = document.getElementById('blogsGrid');
    const blogsLoading = document.getElementById('blogsLoading');
    const noBlogs = document.getElementById('noBlogs');
    
    let debounceTimer;
    
    // Initial load
    loadBlogs();
    
    // Debounce search input to prevent excessive API calls
    blogSearch.addEventListener('input', function() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(loadBlogs, 500);
    });
    
    // Immediate load on filter change
    departmentFilter.addEventListener('change', loadBlogs);
    
    function loadBlogs() {
        const searchQuery = blogSearch.value;
        const departmentSlug = departmentFilter.value;
        
        // Show loading state and hide results/no-results
        blogsLoading.style.display = 'block';
        blogsGrid.style.display = 'none';
        noBlogs.style.display = 'none';
        
        // Fetch data from the API endpoint
        fetch(`/api/blogs?search=${encodeURIComponent(searchQuery)}&department=${encodeURIComponent(departmentSlug)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(blogs => {
                blogsLoading.style.display = 'none';
                
                if (blogs && blogs.length > 0) {
                    displayBlogs(blogs);
                    blogsGrid.style.display = 'grid';
                } else {
                    noBlogs.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error loading blogs:', error);
                blogsLoading.style.display = 'none';
                noBlogs.style.display = 'block';
            });
    }
    
    function displayBlogs(blogs) {
        blogsGrid.innerHTML = blogs.map(blog => {
            const imagePath = blog.image_path || 'img/blogs/default.jpg';
            const imageUrl = `/static/${imagePath}`; 
            
            return `
            <article class="blog-card" onclick="window.location.href='/blog/${blog.slug}'" role="link" tabindex="0">
                <div class="blog-image">
                    <img src="${imageUrl}" alt="${blog.title}" onerror="this.src='/static/img/blogs/default.jpg'">
                </div>
                <div class="blog-content">
                    <h3 class="blog-title">${blog.title}</h3>
                    <div class="blog-date">${formatDate(blog.created_at)}</div>
                    <div class="read-more-container">
                        <a href="/blog/${blog.slug}" class="read-more-btn" aria-label="Read more about ${blog.title}" onclick="event.stopPropagation()">
                            Read More
                        </a>
                    </div>
                </div>
            </article>
            `;
        }).join('');
    }
    
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
    }

    // Initialize ARIA attributes for accessibility
    blogSearch.setAttribute('aria-label', 'Search health articles');
    departmentFilter.setAttribute('aria-label', 'Filter articles by department');
    
    // Add touch improvements for mobile
    document.addEventListener('touchstart', function() {}, { passive: true });
});
</script>
{% endblock %}