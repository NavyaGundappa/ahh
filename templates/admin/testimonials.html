{% extends "admin_layout.html" %}

{% block title %}
Manage Testimonials - Admin Panel
{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-bold">Manage Testimonials</h2>
    <a href="{{ url_for('admin_dashboard') }}"
        class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition">
        Back to Dashboard
    </a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-1">
        <form method="POST" enctype="multipart/form-data" class="bg-white p-6 rounded shadow-md">
            <h3 class="font-semibold text-lg mb-4">Add New Testimonial</h3>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Alt Text</label>
                <input type="text" name="alt_text"
                    class="w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="e.g., Patient from Bengaluru">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Image</label>
                <input type="file" name="image"
                    class="w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    required accept="image/*">
            </div>
            <button type="submit"
                class="w-full bg-blue-500 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 transition">
                Upload Testimonial
            </button>
        </form>
    </div>

    <div class="lg:col-span-2">
        <h3 class="mb-3 text-lg font-bold">Existing Testimonials</h3>
        <div class="bg-white rounded shadow-md">
            <ul class="divide-y divide-gray-200">
                {% for testimonial in testimonials %}
                <li class="p-4 flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        {% set image_path = 'img/' + testimonial.image_path.replace('\\', '/') %}
                        <img src="{{ url_for('static', filename=image_path) }}" alt="{{ testimonial.alt_text }}"
                            class="w-24 h-16 object-cover rounded cursor-pointer hover:opacity-80 transition"
                            onclick="openImageModal('{{ url_for('static', filename=image_path) }}', '{{ testimonial.alt_text }}')">
                        <span class="font-medium text-gray-800">{{ testimonial.alt_text }}</span>
                    </div>
                    <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-3 rounded text-xs"
                        onclick="openModal('deleteModal-{{ testimonial.id }}')">Delete</button>
                </li>
                {% else %}
                <li class="p-4 text-center text-gray-500">
                    No testimonials yet.
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

{% for testimonial in testimonials %}
<div id="deleteModal-{{ testimonial.id }}"
    class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Delete Testimonial</h3>
            <p class="text-sm text-gray-500 mt-2">Are you sure you want to delete this testimonial?</p>
            <div class="flex justify-center items-center px-4 py-3 mt-4">
                <form action="{{ url_for('delete_testimonial', testimonial_id=testimonial.id) }}" method="POST">
                    <button type="button" onclick="closeModal('deleteModal-{{ testimonial.id }}')"
                        class="bg-gray-500 text-white px-4 py-2 rounded font-bold hover:bg-gray-700 transition">Cancel</button>
                    <button type="submit"
                        class="bg-red-500 text-white px-4 py-2 rounded font-bold hover:bg-red-700 transition ml-2">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<div id="imageModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 overflow-y-auto h-full w-full hidden">
    <div
        class="relative top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-4 border max-w-3xl w-auto shadow-lg rounded-md bg-white text-center">
        <h3 id="imageModalTitle" class="text-lg leading-6 font-medium text-gray-900 mb-4"></h3>
        <img id="modalImage" src="" alt="" class="max-h-[75vh] w-auto rounded inline-block">
        <button type="button" onclick="closeModal('imageModal')"
            class="absolute top-2 right-2 bg-gray-200 text-gray-800 rounded-full h-8 w-8 flex items-center justify-center font-bold hover:bg-gray-300 transition">&times;</button>
    </div>
</div>


<script>
    function openModal(modalId) {
        document.getElementById(modalId).classList.remove('hidden');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.add('hidden');
    }

    function openImageModal(src, alt) {
        document.getElementById('modalImage').src = src;
        document.getElementById('modalImage').alt = alt;
        document.getElementById('imageModalTitle').innerText = alt;
        openModal('imageModal');
    }
</script>
{% endblock %}