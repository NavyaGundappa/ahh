{% extends "admin_layout.html" %}

{% block title %}
Manage Banners - Admin Panel
{% endblock %}

{% block content %}
<h2 class="mb-4 text-2xl font-bold">Manage Banners</h2>
<div class="flex justify-end mb-3">
    <a href="{{ url_for('admin_dashboard') }}"
        class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition">
        Back to Dashboard
    </a>
</div>

<form method="POST" enctype="multipart/form-data" class="bg-white p-6 rounded shadow-md mb-4">
    <h3 class="font-semibold text-lg mb-4">Add New Banner</h3>
    <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2">Title</label>
        <input type="text" name="title"
            class="w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2">Alt Text</label>
        <input type="text" name="alt_text"
            class="w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="button_text_new">Button Text (Optional - e.g.,
            Book
            an Appointment)</label>
        <input type="text" name="button_text" id="button_text_new"
            class="w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="button_link_new">Button Link (Optional - e.g.,
            /appointments or full URL)</label>
        <input type="text" name="button_link" id="button_link_new" placeholder="/appointments"
            class="w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2">Image</label>
        <input type="file" name="image"
            class="w-full px-3 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            required>
    </div>
    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 transition">Add
        Banner</button>
</form>

<h3 class="mb-3 text-lg font-bold">Current Banners</h3>


{% if banners %}
<div class="overflow-x-auto bg-white rounded shadow-md">
    <table class="min-w-full leading-normal">
        <thead>
            <tr>
                <th
                    class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                    Title</th>
                <th
                    class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                    Image</th>
                <th
                    class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                    Alt Text</th>
                <th
                    class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                    Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for banner in banners %}
            <tr>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">{{ banner.title }}</td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    <img src="{{ url_for('static', filename='img/' + banner.image_path) }}" alt="{{ banner.alt_text }}"
                        class="w-32 h-auto rounded">
                </td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">{{ banner.alt_text }}</td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    <button class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded text-xs"
                        onclick="openEditModal('{{ banner.id }}')">Edit</button>
                    <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded text-xs"
                        onclick="openDeleteModal('{{ banner.id }}')">Delete</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-gray-500">No banners yet.</p>
{% endif %}

{% for banner in banners %}
<div id="editModal-{{ banner.id }}" class="modal fixed inset-0 z-50 overflow-auto bg-gray-900 bg-opacity-50 hidden">
    <div class="relative top-20 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Edit Banner: {{ banner.title }}</h3>
            <div class="mt-2 px-7 py-3">
                <form action="{{ url_for('edit_banner', banner_id=banner.id) }}" method="POST"
                    enctype="multipart/form-data">

                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Title</label>
                        <input type="text" name="title" value="{{ banner.title }}"
                            class="w-full px-3 py-2 border rounded shadow-sm" required>
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Alt Text</label>
                        <input type="text" name="alt_text" value="{{ banner.alt_text or '' }}"
                            class="w-full px-3 py-2 border rounded shadow-sm">
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2"
                            for="button_text_{{ banner.id }}">Button Text (Optional)</label>
                        <input type="text" name="button_text" id="button_text_{{ banner.id }}"
                            value="{{ banner.button_text or '' }}" class="w-full px-3 py-2 border rounded shadow-sm">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2"
                            for="button_link_{{ banner.id }}">Button Link (Optional)</label>
                        <input type="text" name="button_link" id="button_link_{{ banner.id }}"
                            value="{{ banner.button_link or '' }}" placeholder="/appointments"
                            class="w-full px-3 py-2 border rounded shadow-sm">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Current Image</label>
                        <img src="{{ url_for('static', filename='img/' + banner.image_path) }}"
                            alt="Current Banner Image" class="max-w-xs h-auto mb-2">
                        <input type="hidden" name="existing_image" value="{{ banner.image_path }}">
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Upload New Image (Optional)</label>
                        <input type="file" name="file" accept=".jpg, .jpeg, .png, .gif"
                            class="w-full px-3 py-2 border rounded shadow-sm">
                    </div>

                    <div class="items-center px-4 py-3">
                        <button type="submit"
                            class="bg-blue-500 text-white px-4 py-2 rounded font-bold hover:bg-blue-700 transition">Save
                            Changes</button>
                        <button type="button" onclick="closeModal('editModal-{{ banner.id }}')"
                            class="bg-gray-500 text-white px-4 py-2 rounded font-bold hover:bg-gray-700 transition ml-2">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="deleteModal-{{ banner.id }}"
    class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <h3 class="text-lg leading-6 font-medium text-gray-900">Delete Banner</h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-sm text-gray-500">Are you sure you want to delete the banner titled "{{ banner.title }}"?
                </p>
            </div>
            <div class="items-center px-4 py-3">
                <form action="{{ url_for('delete_banner', banner_id=banner.id) }}" method="POST">
                    <button type="submit"
                        class="bg-red-500 text-white px-4 py-2 rounded font-bold hover:bg-red-700 transition">Delete</button>
                    <button type="button" onclick="closeModal('deleteModal-{{ banner.id }}')"
                        class="bg-gray-500 text-white px-4 py-2 rounded font-bold hover:bg-gray-700 transition ml-2">Cancel</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<script>
    function openEditModal(bannerId) {
        document.getElementById('editModal-' + bannerId).classList.remove('hidden');
    }

    function openDeleteModal(bannerId) {
        document.getElementById('deleteModal-' + bannerId).classList.remove('hidden');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.add('hidden');
    }
</script>
{% endblock %}